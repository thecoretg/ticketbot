<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ticketbot Admin</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>

<!-- Login -->
<div id="login" class="screen hidden">
    <div class="login-card">
        <h1>Ticketbot</h1>
        <p>Sign in to continue</p>
        <div class="form-group">
            <input id="login-email" type="email" placeholder="Email" autocomplete="email">
        </div>
        <div class="form-group">
            <input id="login-password" type="password" placeholder="Password" autocomplete="current-password">
        </div>
        <button id="login-btn" class="btn btn-primary" onclick="login()">Login</button>
        <p id="login-err" class="error-text hidden"></p>
    </div>
</div>

<!-- TOTP Verify -->
<div id="totp-verify" class="screen hidden">
    <div class="login-card">
        <h1>Two-Factor Auth</h1>
        <p>Enter the 6-digit code from your authenticator app, or use a recovery code.</p>
        <div class="form-group">
            <input id="totp-code" type="text" inputmode="numeric" autocomplete="one-time-code" placeholder="000000" maxlength="20">
        </div>
        <button id="totp-btn" class="btn btn-primary" onclick="submitTOTPVerify()">Verify</button>
        <p id="totp-err" class="error-text hidden"></p>
    </div>
</div>

<!-- Password Reset (forced on first login) -->
<div id="password-reset" class="screen hidden">
    <div class="login-card">
        <h1>Change Password</h1>
        <p>Your password must be changed before continuing.</p>
        <div class="form-group">
            <input id="reset-current" type="password" placeholder="Current password" autocomplete="current-password">
        </div>
        <div class="form-group">
            <input id="reset-new" type="password" placeholder="New password" autocomplete="new-password">
            <div id="reset-reqs" class="pwd-reqs"></div>
        </div>
        <div class="form-group">
            <input id="reset-confirm" type="password" placeholder="Confirm new password" autocomplete="new-password">
        </div>
        <button id="reset-btn" class="btn btn-primary" onclick="submitPasswordReset()">Change Password</button>
        <p id="reset-err" class="error-text hidden"></p>
    </div>
</div>

<!-- App -->
<div id="app" class="screen hidden">
    <header class="header">
        <span class="header-title">Ticketbot Admin</span>
        <div class="account-menu">
            <button class="btn btn-ghost btn-sm account-btn" onclick="toggleAccountMenu(event)">
                <span id="header-email">Account</span><span class="account-caret">▾</span>
            </button>
            <div id="account-dropdown" class="account-dropdown hidden">
                <div class="account-dropdown-email" id="dropdown-email">—</div>
                <button class="account-dropdown-item" onclick="showChangePasswordModal()">Change Password</button>
                <button id="totp-menu-btn" class="account-dropdown-item" onclick="handleTOTPMenuClick()"></button>
                <button class="account-dropdown-item account-dropdown-item--danger" onclick="logout()">Logout</button>
            </div>
        </div>
    </header>
    <nav class="tab-nav">
        <button class="tab active" data-tab="rules"    onclick="switchTab('rules')">Rules</button>
        <button class="tab"        data-tab="forwards" onclick="switchTab('forwards')">Forwards</button>
        <button class="tab"        data-tab="users"    onclick="switchTab('users')">Users</button>
        <button class="tab"        data-tab="keys"     onclick="switchTab('keys')">Keys</button>
        <button class="tab"        data-tab="sync"     onclick="switchTab('sync')">Sync</button>
        <button class="tab"        data-tab="config"   onclick="switchTab('config')">Config</button>
    </nav>
    <main id="content" class="content"></main>
</div>

<!-- Modal -->
<div id="modal-overlay" class="modal-overlay hidden" onclick="handleOverlayClick(event)">
    <div id="modal" class="modal">
        <div class="modal-header">
            <h2 id="modal-title"></h2>
            <button class="btn-icon" onclick="closeModal()">✕</button>
        </div>
        <div id="modal-body" class="modal-body"></div>
        <div id="modal-footer" class="modal-footer">
            <button class="btn btn-ghost" onclick="closeModal()">Cancel</button>
            <button id="modal-submit" class="btn btn-primary">Create</button>
        </div>
    </div>
</div>

<!-- Toast -->
<div id="toast" class="toast hidden"></div>

<script src="app.js"></script>
</body>
</html>
